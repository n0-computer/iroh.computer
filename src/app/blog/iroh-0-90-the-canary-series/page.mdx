import { BlogPostLayout } from '@/components/BlogPostLayout'
import { MotionCanvas } from '@/components/MotionCanvas'

export const post = {
  draft: false,
  author: 'ramfox',
  date: '2025-06-27',
  title: 'iroh v0.90 - The Canary Series ğŸ¥',
  description: 'Introducing the Canary Series of releases leading up to 1.0',
}

export const metadata = {
    title: post.title,
    description: post.description,
    openGraph: {
      title: post.title,
      description: post.description,
      images: [{
        url: `/api/og?title=Blog&subtitle=${post.title}`,
        width: 1200,
        height: 630,
        alt: post.title,
        type: 'image/png',
      }],
      type: 'article'
    }
}

export default (props) => <BlogPostLayout article={post} {...props} />

Welcome to a new release of `iroh`, a library for building on direct connections between devices, putting more control in the hands of your users.

**TL;DR: Weâ€™re jumping to v0.90 as the *canary* release series leading to 1.0. If youâ€™re cool working on the bleeding edge, use 0.90. If you want to wait for 1.0, stick with v0.35.x. until we cut 1.0 toward the end of the year.**

Last time we published a release blog, we said our next release would be our release candidate for `1.0`. But, while working through all of our breaking changes and updates, we realized that waiting until we had everything worked through and finished before releasing was *not* actually the best way for us to get a stable release into the hands of our users.

In the pre 1.0 era, weâ€™d found that 3 week release cycles were the sweet spot for our team. Not only did 3-week cycles help our working cadence, but it also made sure we got user feedback quickly, and allowed us to move forward with confidence. We want that confidence more than ever going into 1.0.

So, weâ€™ve decided that along with maintaining the `0.35` release (as well as the public infrastructure that supports `0.35`), we will be doing a series of releases that we will refer to as the â€œcanaryâ€ releases. They will be versioned releases starting with `0.90`, and continuing up until we are ready for our `1.0-rc`.

The biggest difference between the way we are thinking about our new series of releases is, starting with `0.90`, we are not guaranteeing network/protocol level stability until we make it to `1.0-rc`.

So for those who:
- are starting fresh with iroh
- want to be on the cutting edge
- do not need worry about backwards-compatibility for their networks
- are still in the prototyping stage, or have small, easily updated deployments

We **highly** recommend coming along with us on our `0.90` canary journey. Our `0.90`, for example, already includes performance improvements, and we want you to benefit from these kinds of changes ASAP.

But, if your network cannot tolerate multiple breaking changes over a short period of time (on the order of months), then stay on the `0.35` series until we have a release candidate.

We appreciate your patience as we figure out the best way to get to a stable `1.0` as soon as possible!

There are MANY breaking changes in this release, please do check out the â€œBreaking Changesâ€ section below to see what those changes are in detail. Below are the highlights:

## ğŸ’¥Â Concrete Errors ğŸ’¥

All of our APIs now return concrete errors!

This is going to be most obvious for those of you who have implemented versions of Discovery Services, or written your own protocols on `iroh`.

**PLEASE** [give us feedback](https://github.com/n0-computer/iroh/issues/3352) on our new concrete errors. This was a large change that touched most of the codebase and we are still lacking some documentation. But we want to make sure that this change works for you.

## ğŸš§Â TLS x509 certificate option removed ğŸš§

As described in our [last release blog post](/blog/iroh-0-35-prepping-for-1-0#release-candidate-logistics), we no longer support `x509` TLS certifications in `iroh` . We have removed the `iroh::endpoint::Builder::tls_x509`  and the `iroh::endpoint::Builder::tls_raw_public_keys` endpoint builder options, since we now default to using raw public keys.

## ğŸ˜¯Â iroh-relays no longer support STUN ğŸ˜¯

`iroh` no longer uses the STUN protocol to learn about our external addresses. We now rely on QUIC address discovery to to that. To that effect, the `iroh-relay`s starting from `0.90` no longer support the STUN protocol. Our `iroh` configuration has also changed, as the `RelayNode` now only has `quic` configuration options.

## ğŸ‘€Â `n0-watcher` crate, and the `Watcher` trait ğŸ‘€

Many of APIs now return `impl Watcher` , like the `Endpoint::node_addr` method. Knowing your nodeâ€™s `NodeAddr` may take a few milliseconds, since it needs to do some probing to discover its own public facing addresses (if any exist). Returning a `Watcher` here allows our users to â€œwaitâ€ for the `NodeAddr` value to â€œinitializeâ€ and also watch for any potential changes to our `NodeAddr`, in case the user needs to inform other processes about any address changes.

Take a look at the [n0-watcher](https://docs.rs/n0-watcher/0.2.0/n0_watcher/) crate docs for more info, but just know that the `Watcher` trait is re-exported in `iroh`, so if you want to use the `Endpoint::node_addr` or `Endpoint::home_relay` methods in `iroh`, you will also need to import the `iroh::Watcher` trait.

## âš ï¸ Breaking Changes

- iroh
    - removed
        - `iroh::endpoint::Builder:: tls_x509`Â removed, this is the tls mechanism that has been removed
        - `iroh::endpoint::Builder:: tls_raw_public_keys` Â removed, this is the default mechanism now, so not needed anymore
        - `Display`Â implementation was removed forÂ `SecretKey`, useÂ `.to_bytes()`Â and encode as hex to get the previous bytes explicitly, for example:

        ```rust
        let encoded_key = data_encoding::HEXLOWER.encode(&secret_key.to_bytes())
        ```

        - removedÂ `iroh_relay::protos::stun::StunError`
        - removedÂ `iroh_relay::server::testing::stun_config`
        - removedÂ `iroh_relay::protos::stun`
        - removedÂ `iroh_relay::quic::QuicClient::get_addr_and_latency`
        - removedÂ `DEFAULT_STUN_PORT`
        - RemovedÂ `iroh::discovery::dns::DnsDiscovery::new`, useÂ `DnsDiscovery::builder`Â instead
        - RemovedÂ `iroh::discovery::pkarr::PkarrPublisher::new`, useÂ `PkarrPublisher::builder`Â instead
        - RemovedÂ `iroh::discovery::pkarr::PkarrPublisher::with_options`, useÂ `PkarrPublisher::builder`Â instead
        - RemovedÂ `iroh::discovery::pkarr::PkarrResolver::new`, useÂ `PkarrResolver::builder`Â instead
    - changed
        - all public APIs return concrete error types, rather than `anyhow::Error`
        - `iroh::protocol::ProtocolHandler`Â methods now returnÂ `impl Future`Â instead ofÂ `BoxFuture`. You can simply remove theÂ `Box::pin(async move {})`Â from the implementations and instead implement the methods asÂ `async fn`. See the updated documentation for theÂ `iroh::protocol`Â module for an example.
        - `iroh::protocol::ProtocolHandler`Â is no longer dyn-compatible. If you need a dyn-compatible version, you need to build your own dyn-compatible wrapper trait. See the (non-public)Â `DynProtocolHandler`Â inÂ `iroh::protocol`Â as an example.
        - `iroh::watcher`Â is now its own crateÂ `n0-watcher`, but the `Watcher` trait is still a top level export in `iroh`
        - `iroh::endpoint::Endpoint::node_addr`Â now returnsÂ `impl Watcher<Value = Option<NodeAddr>>`
        - `iroh::endpoint::Endpoint::home_relay`Â now returnsÂ `impl Watcher<Value = Vec<RelayUrl>>`
        - `iroh::endpoint::Endpoint::bound_sockets`Â now returnsÂ `Vec<SocketAddr>`
        - `iroh-quinn`Â is updated toÂ `0.14.0`
        - `iroh::protocol::RouterBuilder::accept`Â now takesÂ `impl Into<Box<dyn DynProtocolHandler>>`Â instead ofÂ `impl ProtocolHandler`. Because of a blanketÂ `From`Â impl this change does not need any changes by users: you can still pass anyÂ `impl ProtocolHandler`Â toÂ `accept`. Additionally, if you have your own builder struct upstream, you can now also pass aÂ `Box<dyn DynProtocolHandler>`Â toÂ `accept`, which wasn't possible previously.
        - `iroh::discovery::Lagged`Â changed from a tuple to a struct
        - `iroh::watcher::Disconnected`Â is changed from a tuple to a struct
        - `iroh::watcher::Disconnected`Â is no longerÂ `UnwindSafe`Â orÂ `RefUnwindSafe`
        - `iroh::watcher::InitializedFut`Â is no longerÂ `RefUnwindSafeiroh-base`
        - `iroh::endpoint::Builder::add_discovery`Â now takes anÂ `impl iroh::discovery::IntoDiscovery`Â argument instead of a closure that returns aÂ `Discovery`. You can implement that on a builder struct, and anyÂ `T: Discovery`Â has an auto-impl ofÂ `IntoDiscovery`.
        - `iroh::discovery::Discovery::resolve`Â no longer gets aÂ `&Endpoint`Â argument. If you need an endpoint in your discovery service, add a builder struct and implementÂ `IntoDiscovery`Â for it, which gives you an endpoint that you can clone into your service
        - `iroh::discovery::pkarr::PkarrPublisher::n0_dns`Â now takes no arguments and returns aÂ `PkarrPublisherBuilder`. The secret key is set onÂ `PkarrPublisherBuilder::build`Â instead.
- `iroh-base`
    - `changed`
        - `iroh_base::ticket::Error`Â is renamed toÂ `iroh_base::ticket::ParseError`
        - `iroh_base::key::KeyParsingError`Â has changed from aÂ `thiserror`Â error to aÂ `snafu`Â error`iroh-relay`
- `iroh-relay`
    - `changed`
        - `iroh_relay::node_info::MaxLengthExceededError`Â is no longerÂ `UnwindSafe`Â orÂ `RefUnwindSafe`
        - `iroh_relay::node_info::MaxLengthExceededError`Â was changed from aÂ `thiserror`Â to aÂ `snafu`Â error
        - `iroh_relay::client::ConnSendError`Â is nowÂ `iroh_relay::client::SendError`
        - `iroh_relay::protos::stun::Error`Â is nowÂ `iroh_relay::protos::stun::StunError`

### But wait, there's more!

Many bugs were squashed, and smaller features were added. For all those details, check out the full changelog: https://github.com/n0-computer/iroh/releases/tag/v0.90.0.

If you want to know what is coming up, check out the [v0.99.0 milestone](https://github.com/n0-computer/iroh/milestone/34), and if you have any wishes, let us know about the [issues](https://github.com/n0-computer/iroh/issues)! If you need help using iroh or just want to chat, please join us on [discord](https://discord.com/invite/DpmJgtU7cW)! And to keep up with all things iroh, check out our [Twitter](https://x.com/iroh_n0).
